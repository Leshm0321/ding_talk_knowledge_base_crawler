# 钉钉知识库文件下载工具

一个基于 Python 的钉钉知识库批量文件下载工具，支持自动遍历知识库目录结构并下载所有可访问的文件。

## 功能特点

- 🚀 **多线程并发下载**：支持多浏览器实例并发处理，提高下载效率
- 📁 **智能目录结构保存**：自动保持原知识库的目录结构
- 📄 **多格式文件支持**：支持文档、表格、PPT、PDF、图片、压缩包等多种文件格式
- 🔍 **权限检测**：自动识别无权限访问的文件并跳过
- 📊 **详细下载报告**：生成完整的下载日志和统计报告
- 🔄 **失败重试机制**：支持下载失败自动重试
- 💾 **断点续传**：已下载的文件会被自动跳过

## 支持的文件格式

### 文档类
- **钉钉文档** (.adoc) → 导出为 Word 格式
- **Word文档** (.docx, .doc) → 直接下载
- **PDF文档** (.pdf) → 直接下载
- **文本文件** (.txt, .md, .log) → 直接下载或保存内容

### 表格类
- **钉钉表格** (.axls) → 导出为 Excel 格式
- **Excel文件** (.xlsx, .xls, .csv) → 直接下载

### 演示文稿
- **PPT文件** (.pptx, .ppt) → 导出为 PowerPoint 或 PDF 格式

### 其他格式
- **图片文件** (.jpg, .jpeg, .png, .gif, .bmp, .svg, .webp)
- **压缩文件** (.zip, .rar, .7z, .tar, .gz)
- **链接文件** (.dlink) → 自动识别真实文件类型

## 环境要求

- Python 3.7+
- Chrome 浏览器（用于自动化操作）

## 安装步骤

1. 克隆项目到本地：
```bash
git clone git@github.com:Leshm0321/ding_talk_knowledge_base_crawler.git
cd ding_talk_knowledge_base_crawler
```

2. 安装依赖包：
```bash
pip install -r requirements.txt
```

## 配置说明

在使用前，需要配置 `.env` 文件中的参数：

1. 复制配置文件模板（如果不存在）：
```bash
cp .env.example .env
```

2. 编辑 `.env` 文件，填入您的配置信息：

```env
# 公司ID - 从钉钉知识库网页版地址栏中获取或者F12抓包网络请求搜索获取
CORP_ID=xxxx

# 组织（库）ID - 从知识库页面地址栏中获取
TARGET_ORGID=xxxx
```

### 获取配置参数的方法：

1. **公司ID (CORP_ID)**：
   - 登录钉钉知识库网页版
   - 在浏览器地址栏中找到类似 `corpId=xxxxxxxxxx` 的参数
   - 或者F12抓请求，在请求中搜索corpId查找公司ID

2. **组织ID (TARGET_ORGID)**：
   - 进入目标知识库
   - 在地址栏中找到类似 `/spaces/xxxxxxxxxx/` 的路径部分
   - 只需要 `spaces/` 后面的部分

## 使用方法

1. **启动程序**：
```bash
python main.py
```

2. **完成登录**：
   - 程序会自动打开多个浏览器窗口
   - 在每个窗口中完成钉钉账号登录
   - 登录完成后，在命令行按任意键继续

3. **开始下载**：
   - 程序会自动遍历知识库结构
   - 自动下载所有有权限访问的文件
   - 文件将保存在程序目录下的 `{组织ID}` 文件夹中

4. **查看结果**：
   - 下载完成后按任意键查看详细报告
   - 报告包含下载统计、失败文件列表等信息

## 输出文件说明

程序运行后会生成以下文件：

### 日志文件
- `failed_files.log` - 下载失败的文件记录
- `no_right_files.log` - 无权限访问的文件记录
- `skipped_files.log` - 跳过的文件记录
- `download_report.txt` - 完整的下载报告

### 下载目录
```
{组织ID}/
├── 文件夹1/
│   ├── 子文件夹/
│   │   ├── 文件1.docx
│   │   └── 文件2.xlsx
│   └── 文件3.pdf
└── 文件4.pptx
```

## 注意事项

⚠️ **重要提醒**：

1. **权限合规**：仅用于下载您有权限访问的文件，请遵守相关法律法规
2. **合理使用**：避免频繁请求，以免对钉钉服务器造成压力
3. **网络稳定**：下载过程中请保持网络连接稳定
4. **存储空间**：确保有足够的磁盘空间存储下载的文件
5. **浏览器窗口**：请勿手动关闭程序打开的浏览器窗口

## 常见问题

### Q: 提示"暂无权限访问"
A: 这是正常现象，程序会自动记录无权限的文件并继续处理其他文件。

### Q: 下载速度很慢
A: 程序默认使用5个并发实例，可以根据网络情况调整代码中的线程数量。

### Q: 某些文件下载失败
A: 查看生成的日志文件，了解具体失败原因，程序会自动重试失败的下载。

### Q: 如何中断下载
A: 可以直接关闭命令行窗口，已下载的文件会保留。

## 技术架构

- **DrissionPage**：用于浏览器自动化和网页交互
- **loguru**：用于日志记录
- **requests**：用于文件下载请求
- **多线程**：实现并发处理

## 免责声明

本工具仅用于个人学习和研究目的，使用者应确保：
1. 遵守钉钉平台的使用条款
2. 不侵犯他人知识产权
3. 不用于商业用途
4. 承担使用本工具的所有风险和责任

## License

MIT License
